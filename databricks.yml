bundle:
  name: docx-skills-agent

variables:
  agent_model_endpoint:
    default: "databricks-gpt-5-2"
  agent_uc_volume_path:
    default: "hls_amer_catalog.appeals-review.created_docs_dev"
  app_name:
    description: Databricks App name
    default: docx-skills-agent

sync:
  include:
    - app.py
    - start_server.py
    - pyproject.toml
    - uv.lock
    - agent/**
    - .claude/skills/**

resources:
  experiments:
    tracking_exp:
      name: /Workspace/Users/brennan.beal@databricks.com/${bundle.name}-${bundle.target}
      permissions:
        - level: CAN_MANAGE
          group_name: users
  apps:
    document_agent:
      name: ${var.app_name}
      description: ResponsesAgent-powered document assistant with LangGraph tools
      source_code_path: .
      resources:
        - name: experiment
          experiment:
            experiment_id: ${resources.experiments.tracking_exp.id}
            permission: CAN_MANAGE
        - name: serving-endpoint
          serving_endpoint:
            name: ${var.agent_model_endpoint}
            permission: CAN_QUERY
        - name: uc-volume-write
          uc_securable:
            securable_type: VOLUME
            securable_full_name: hls_amer_catalog.appeals-review.created_docs_${bundle.target}
            permission: WRITE_VOLUME
        - name: uc-volume-read
          uc_securable:
            securable_type: VOLUME
            securable_full_name: hls_amer_catalog.appeals-review.created_docs_${bundle.target}
            permission: READ_VOLUME
      config:
        command: ["python", "start_server.py"]
        env:
          - name: MLFLOW_EXPERIMENT_ID
            value_from: experiment
          - name: AGENT_MODEL_ENDPOINT
            value_from: serving-endpoint
          - name: AGENT_UC_VOLUME_PATH
            value_from: uc-volume-write
          - name: AGENT_OUTPUT_MODE
            value: "uc_volume"
          - name: AGENT_SKILLS_DIR
            value: "./.claude/skills"
          - name: AGENT_MAX_ITERATIONS
            value: "10"

targets:
  dev:
    default: true
    workspace:
      profile: FEVM

  prod:
    mode: production

